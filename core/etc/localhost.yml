/core:
  name: facet-localhost

/ping:
  msg: Greetings from restheart-local!

/http-listener:
  host: local.getfacet.org

/logging:
  log-level: debug
  packages: [org.restheart, org.facet]
  full-stacktrace: true
  ansi-console: true
  requests-log-mode: 1

/mclient:
  connection-string: mongodb://localhost

/mongo/mongo-mounts:
  - what: "*"
    where: /

# restheart cloud setup with wildcard mongo mounts
# /mongo/mongo-mounts:
#  - what: /{host[0]}/{*}
#    where: /{*}

/graphql:
  enabled: false

/bruteForceAttackGuard:
  enabled: false

/rndTokenManager:
  enabled: false

/tokenBasicAuthMechanism:
  enabled: false

/jwtTokenManager:
  enabled: true
  ttl: 15  # Token expiration time in minutes (new: was 600 seconds, now 15 minutes)
  srv-uri: /token  # OAuth 2.0-compatible endpoint (changed from /tokens)

# JWT configuration provider (new in RH9) - centralizes JWT settings
/jwtConfigProvider:
  key: 8W4ZfCjF4WFAWzt5xG6bXliWDLmDT8Ou
  algorithm: HS256
  base64Encoded: false
  issuer: org.getfacet

/jwtAuthenticationMechanism:
  enabled: true
  base64Encoded: false  # Required: whether the JWT key is base64 encoded
  usernameClaim: sub
  rolesClaim: roles
  fixedRoles: []

/authCookieSetter:
  enabled: true
  name: rh_auth
  domain: getfacet.org  # RFC 6265 compliant: no leading dot
  path: /
  secure: false  # Must be false for HTTP (localhost development)
  http-only: true
  same-site: true
  same-site-mode: strict
  ttl: 15  # Cookie expiration time in minutes (matches jwtTokenManager/ttl)
  allow-legacy: true  # Allow legacy ?set-auth-cookie query parameter for backward compatibility

/authCookieHandler:
  enabled: true

/authCookieRemover:
  enabled: true
  secure: false

# ============================================================================
# RESTHeart Browser - MongoDB Web Interface
# ============================================================================
# RESTHeart Browser provides a web-based interface for browsing MongoDB data.
# It requires the following plugins to be enabled:
#
# REQUIRED PLUGINS:
#   1. pebble-template-processor   - Template engine for HTML rendering
#   2. login-service               - Generic login service (/login endpoint)
#   3. restheart-browser           - Main browser service (/browser routes)
#   4. html-response-interceptor   - Transforms responses to HTML (MongoDB + JSON)
#   5. authCookieSetter/Handler/Remover - RESTHeart cookie authentication
# ============================================================================

# Template engine - processes Pebble templates
/pebble-template-processor:
  enabled: true
  use-file-loader: true      # Load templates from filesystem (for hot-reload in dev)
  cache-active: false        # Enable Pebble template caching (enable in production)
  # locale: en-US            # Optional: ISO language tag (e.g., en-US, en-GB, it-IT)

# Generic login service - handles authentication with RESTHeart cookie flow
/login-service:
  enabled: true
  uri: /login                    # Mandatory: mount point for login page
  redirect-param: redirect       # Query param for post-login redirect (default: "redirect")
  roles-endpoint: /roles         # RESTHeart roles endpoint (for Alpine component)

# Browser service - returns JSON data, HtmlResponseInterceptor transforms to HTML
/restheart-browser:
  enabled: true
  uri: /browser              # Mandatory: mount path for browser service

# Generic HTML interceptor - transforms JSON/BSON responses to HTML
/html-response-interceptor:
  enabled: true
  response-caching: false   # Enable response caching with ETag (disable in development)
  max-age: 5                # Cache-Control max-age in seconds (default: 5) - works if caching enabled

# Authentication redirect - REGISTERED BY LoginService (do not enable here)
/html-auth-redirect-interceptor:
  enabled: false
  # LoginService registers this interceptor dynamically with login-uri: /login

# Serve static assets from filesystem in development (rh watch)
# For production (deployed jar), use: what: /static, embedded: true
/static-resources:
  - what: /Users/mturatti/src/softinstigate/restheart-browser/src/main/resources/static/
    where: /assets
    embedded: false
  # Serve favicon at root to prevent browser auth popup on automatic /favicon.ico requests
  # Browsers automatically request /favicon.ico from domain root regardless of <link> tags
  # Without this mount, /favicon.ico hits authentication → 401 → WWW-Authenticate header → browser login popup
  # This mount ensures favicon.ico is served without authentication (same file as /assets/favicon.ico)
  - what: /Users/mturatti/src/softinstigate/restheart-browser/src/main/resources/static/favicon.ico
    where: /favicon.ico
    embedded: false
